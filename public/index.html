<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>K-Drama TOPIK</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Noto Sans KR', sans-serif;
      background: #f5f5f5;
      color: #222;
      min-height: 100vh;
    }

    /* â”€â”€ Header â”€â”€ */
    header {
      background: #fff;
      padding: 14px 20px;
      text-align: center;
      border-bottom: 2px solid #e0e0e0;
    }

    .logo {
      font-size: 1.5rem;
      font-weight: 900;
      color: #1a1a2e;
      letter-spacing: 1px;
    }

    .logo .play { color: #e94560; }

    /* â”€â”€ Main â”€â”€ */
    .container {
      max-width: 720px;
      margin: 0 auto;
      padding: 24px 16px;
    }

    /* â”€â”€ Player â”€â”€ */
    .player-wrap {
      position: relative;
      width: 100%;
      padding-bottom: 56.25%;
      background: #000;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.12);
    }

    .player-wrap iframe {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border: 0;
    }

    /* â”€â”€ Subtitle â”€â”€ */
    .subtitle-box {
      margin-top: 16px;
      background: #fff;
      border-radius: 12px;
      padding: 20px 24px;
      text-align: center;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.06);
      min-height: 88px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      gap: 8px;
      cursor: pointer;
      user-select: none;
      transition: border-radius 0.3s;
    }

    .subtitle-box.open {
      border-radius: 12px 12px 0 0;
    }

    .subtitle-toggle {
      font-size: 0.75rem;
      color: #bbb;
      margin-top: 4px;
      transition: opacity 0.2s;
    }

    /* â”€â”€ Detail Panel â”€â”€ */
    .detail-panel {
      background: #fff;
      border-radius: 0 0 12px 12px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.06);
      overflow: hidden;
      max-height: 0;
      transition: max-height 0.35s ease;
    }

    .detail-panel.open {
      max-height: 600px;
    }

    .detail-inner {
      padding: 0 24px 20px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    .detail-section {
      background: #f9f9f9;
      border-radius: 8px;
      padding: 14px;
      text-align: left;
    }

    .detail-section .label {
      font-size: 0.8rem;
      font-weight: 700;
      margin-bottom: 6px;
      color: #444;
    }

    .detail-section .value {
      font-size: 0.85rem;
      color: #555;
    }

    .detail-section.hidden {
      display: none;
    }

    .topik-badge {
      display: inline-block;
      padding: 2px 10px;
      border-radius: 12px;
      font-weight: 700;
      font-size: 0.85rem;
      color: #fff;
    }

    .topik-1 { background: #4caf50; }
    .topik-2 { background: #2196f3; }
    .topik-3 { background: #ff9800; }
    .topik-4 { background: #f44336; }
    .topik-5 { background: #9c27b0; }
    .topik-6 { background: #333; }

    .vocab-item {
      margin-bottom: 4px;
    }

    .vocab-item .vocab-ko {
      font-weight: 700;
    }

    .vocab-item .vocab-ne {
      color: #888;
    }

    .vocab-item .vocab-topik {
      display: inline-block;
      font-size: 0.7rem;
      padding: 1px 6px;
      border-radius: 8px;
      color: #fff;
      margin-left: 4px;
      vertical-align: middle;
    }

    .subtitle-ko {
      font-size: 1.2rem;
      font-weight: 700;
      color: #1a1a2e;
      line-height: 1.6;
    }

    .subtitle-ne {
      font-size: 1.05rem;
      font-weight: 400;
      color: #666;
      line-height: 1.6;
    }

    .subtitle-placeholder {
      color: #bbb;
      font-size: 0.95rem;
    }

    /* â”€â”€ Responsive â”€â”€ */
    @media (max-width: 480px) {
      header { padding: 12px 16px; }
      .logo { font-size: 1.25rem; }
      .container { padding: 16px 12px; }
      .subtitle-box { padding: 16px; }
      .subtitle-ko { font-size: 1.05rem; }
      .subtitle-ne { font-size: 0.95rem; }
      .detail-inner { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <header>
    <div class="logo">K<span class="play">â–¶</span>Drama TOPIK</div>
  </header>

  <div class="container">
    <div class="player-wrap">
      <div id="player"></div>
    </div>

    <div class="subtitle-box" id="subtitle-box" onclick="toggleDetail()">
      <div class="subtitle-ko" id="subtitle-ko"></div>
      <div class="subtitle-ne" id="subtitle-ne"></div>
      <div class="subtitle-placeholder" id="subtitle-placeholder">ì˜ìƒì„ ì¬ìƒí•˜ë©´ ìë§‰ì´ í‘œì‹œë©ë‹ˆë‹¤</div>
      <div class="subtitle-toggle" id="subtitle-toggle">&#9660; ìë§‰ì„ í´ë¦­í•˜ë©´ ìƒì„¸ ì„¤ëª…</div>
    </div>

    <div class="detail-panel" id="detail-panel">
      <div class="detail-inner">
        <div class="detail-section" id="section-tip">
          <div class="label">ğŸ’¡ íŒ (ë¶í•œì‹ â†’ í‘œì¤€ì–´)</div>
          <div class="value" id="detail-tip">-</div>
        </div>
        <div class="detail-section">
          <div class="label">ğŸ“ ë¬¸ë²•</div>
          <div class="value" id="detail-grammar">-</div>
        </div>
        <div class="detail-section">
          <div class="label">ğŸ“Š TOPIK ë ˆë²¨</div>
          <div class="value" id="detail-topik">-</div>
        </div>
        <div class="detail-section" id="section-vocab">
          <div class="label">ğŸ“– ì–´íœ˜</div>
          <div class="value" id="detail-vocab">-</div>
        </div>
      </div>
    </div>
  </div>

<script>
var player;
var subtitles = [];
var analysisMap = {};
var subtitleTimer = null;
var lastSubId = -1;

fetch('../data/subtitles.json')
  .then(function(res) { return res.json(); })
  .then(function(data) { subtitles = data; });

fetch('../data/analysis.json')
  .then(function(res) { return res.json(); })
  .then(function(data) {
    data.forEach(function(item) { analysisMap[item.id] = item; });
  });

var tag = document.createElement('script');
tag.src = 'https://www.youtube.com/iframe_api';
var firstScriptTag = document.getElementsByTagName('script')[0];
firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

function onYouTubeIframeAPIReady() {
  player = new YT.Player('player', {
    videoId: 'srN85EUD1kI',
    playerVars: {
      rel: 0,
      modestbranding: 1
    },
    events: {
      onReady: onPlayerReady,
      onStateChange: onPlayerStateChange
    }
  });
}

function onPlayerReady(event) {
  // Player is ready
}

function onPlayerStateChange(event) {
  if (event.data === YT.PlayerState.PLAYING) {
    startSubtitleSync();
  } else {
    stopSubtitleSync();
  }
}

function startSubtitleSync() {
  stopSubtitleSync();
  subtitleTimer = setInterval(updateSubtitle, 250);
}

function stopSubtitleSync() {
  if (subtitleTimer) {
    clearInterval(subtitleTimer);
    subtitleTimer = null;
  }
}

function updateSubtitle() {
  var t = player.getCurrentTime();
  var found = null;

  for (var i = 0; i < subtitles.length; i++) {
    if (t >= subtitles[i].s && t < subtitles[i].e) {
      found = subtitles[i];
      break;
    }
  }

  if (found && found.id !== lastSubId) {
    lastSubId = found.id;
    document.getElementById('subtitle-ko').textContent = found.ko;
    document.getElementById('subtitle-ne').textContent = found.ne;
    document.getElementById('subtitle-placeholder').style.display = 'none';
    updateDetail(found.id);
  } else if (!found && lastSubId !== -1) {
    lastSubId = -1;
    document.getElementById('subtitle-ko').textContent = '';
    document.getElementById('subtitle-ne').textContent = '';
  }
}

var topikColors = { 1: 'topik-1', 2: 'topik-2', 3: 'topik-3', 4: 'topik-4', 5: 'topik-5', 6: 'topik-6' };

function updateDetail(id) {
  var a = analysisMap[id];
  var tipSection = document.getElementById('section-tip');
  var vocabSection = document.getElementById('section-vocab');

  if (!a) {
    tipSection.classList.add('hidden');
    document.getElementById('detail-grammar').textContent = '-';
    document.getElementById('detail-topik').innerHTML = '-';
    vocabSection.classList.add('hidden');
    return;
  }

  // Tip
  if (a.tip) {
    tipSection.classList.remove('hidden');
    document.getElementById('detail-tip').textContent = a.tip;
  } else {
    tipSection.classList.add('hidden');
  }

  // Grammar
  document.getElementById('detail-grammar').textContent = a.grammar;

  // TOPIK level
  var cls = topikColors[a.topik] || 'topik-2';
  document.getElementById('detail-topik').innerHTML =
    '<span class="topik-badge ' + cls + '">TOPIK ' + a.topik + '</span>';

  // Vocab
  if (a.vocab && a.vocab.length > 0) {
    vocabSection.classList.remove('hidden');
    var html = '';
    a.vocab.forEach(function(v) {
      var vcls = topikColors[v.topik] || 'topik-2';
      html += '<div class="vocab-item">' +
        '<span class="vocab-ko">' + v.ko + '</span> ' +
        '<span class="vocab-ne">' + v.ne + '</span>' +
        '<span class="vocab-topik ' + vcls + '">' + v.topik + '</span>' +
        '</div>';
    });
    document.getElementById('detail-vocab').innerHTML = html;
  } else {
    vocabSection.classList.add('hidden');
  }
}

function toggleDetail() {
  var box = document.getElementById('subtitle-box');
  var panel = document.getElementById('detail-panel');
  var toggle = document.getElementById('subtitle-toggle');
  var isOpen = panel.classList.toggle('open');
  box.classList.toggle('open', isOpen);
  toggle.innerHTML = isOpen ? '&#9650; ì ‘ê¸°' : '&#9660; ìë§‰ì„ í´ë¦­í•˜ë©´ ìƒì„¸ ì„¤ëª…';
}
</script>
</body>
</html>
